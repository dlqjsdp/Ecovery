<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<th:block layout:fragment="css">
    <link rel="stylesheet" href="/css/mypage-style.css">
</th:block>

<div layout:fragment="content">

    <!-- 메인 콘텐츠 영역 -->
    <main id="mainContent">
        <!-- 프로필 헤더 섹션 -->
        <section class="profile-header">
            <div class="container">
                <div class="profile-banner">
                    <!-- 프로필 정보 섹션 -->
                    <div class="profile-info">
                        <div class="profile-details">
                            <!-- 사용자 이름과 편집 아이콘 -->
                            <div class="user-name-container">
                                <h1 class="user-name" th:text="${member.nickname + '님'}">김환경님</h1>
                                <!-- 회원정보 수정 아이콘 -->
                                <button class="edit-profile-icon" onclick="openProfileModal()" aria-label="회원정보 수정">
                                    <i class="edit-icon">✏️</i>
                                </button>
                            </div>

                            <!-- 사용자 이메일 -->
                            <p class="user-email" th:text="'이메일 : ' + ${member.email}">이메일 : green@greencycle.com</p>

                            <!-- 가입 정보 -->
                            <div class="join-info">
                                <span th:text="'가입일 : ' + ${#dates.format(member.createdAt, 'yyyy.MM.dd')}">가입일 : 2025.07.25</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 대시보드 메인 컨테이너 -->
        <section class="dashboard-main">
            <div class="container">
                <!-- 대시보드 그리드 레이아웃 -->
                <div class="dashboard-grid">

                    <!-- 1. 장바구니 바로가기 섹션 (전체 너비) -->
                    <div class="dashboard-card cart-quicklink">
                        <div class="card-header">
                            <h3>🛒 장바구니 바로가기</h3>
                            <div class="cart-actions">
                                <button class="btn-small" th:onclick="|location.href='@{/cart/list}'|">
                                    장바구니 보기
                                </button>
                                <span class="cart-item-count"></span>
                            </div>
                        </div>
                        <div class="cart-summary">
                            <div class="cart-preview">
                                <div class="cart-item-preview">
                                    <span class="item-icon">🌱</span>
                                    <span class="item-name">친환경 세제</span>
                                </div>
                                <div class="cart-item-preview">
                                    <span class="item-icon">♻️</span>
                                    <span class="item-name">재활용 텀블러</span>
                                </div>
                                <div class="cart-item-preview">
                                    <span class="item-icon">🌿</span>
                                    <span class="item-name">유기농 화분</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. 구매 내역 섹션 -->
                    <div class="dashboard-card purchase-history">
                        <div class="card-header">
                            <h3>📦 구매 내역</h3>
                            <button class="btn-small" th:onclick="|location.href='@{/orders/list}'|">
                                전체보기
                            </button>
                        </div>
                        <div class="card-content">
                            <!-- 구매 통계 -->
                            <div class="purchase-stats">
                                <div class="stat-item">
                                    <span class="stat-number">5</span>
                                    <span class="stat-label">이번 달</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">₩124,000</span>
                                    <span class="stat-label">총 구매액</span>
                                </div>
                            </div>

                            <!-- 최근 구매 내역 -->
                            <div class="recent-purchases">
                                <h4>최근 주문</h4>
                                <div class="purchase-list">
                                    <div class="purchase-item" data-order-id="ORD001">
                                        <div class="item-info">
                                            <span class="item-name">친환경 세제 세트</span>
                                            <span class="item-date">2024.07.20</span>
                                        </div>
                                        <span class="item-status delivered">배송완료</span>
                                    </div>
                                    <div class="purchase-item" data-order-id="ORD002">
                                        <div class="item-info">
                                            <span class="item-name">재활용 텀블러</span>
                                            <span class="item-date">2024.07.18</span>
                                        </div>
                                        <span class="item-status shipping">배송중</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. 나눔 관리 섹션 -->
                    <div class="dashboard-card sharing-management">
                        <div class="card-header">
                            <h3>🤝 나눔 관리</h3>
                            <button class="btn-small" th:onclick="|location.href='@{/free/list}'|">
                                나눔 등록
                            </button>
                        </div>
                        <div class="card-content">
                            <!-- 나눔 통계 -->
                            <div class="sharing-stats">
                                <div class="stat-item">
                                    <span class="stat-number">3</span>
                                    <span class="stat-label">진행중</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">12</span>
                                    <span class="stat-label">완료</span>
                                </div>
                            </div>

                            <!-- 나눔 활동 -->
                            <div class="sharing-activities">
                                <h4>나의 나눔</h4>
                                <div class="sharing-list">
                                    <div class="sharing-item">
                                        <div class="item-info">
                                            <span class="item-name">아이 전집 도서</span>
                                            <span class="item-location">📍 강남구</span>
                                        </div>
                                        <span class="item-status available">나눔중</span>
                                    </div>
                                    <div class="sharing-item">
                                        <div class="item-info">
                                            <span class="item-name">유아 장난감</span>
                                            <span class="item-location">📍 서초구</span>
                                        </div>
                                        <span class="item-status completed">완료</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. 분리배출 내역 섹션 -->
                    <div class="dashboard-card waste-history">
                        <div class="card-header">
                            <h3>♻️ 분리배출 내역</h3>
                            <button class="btn-small" th:onclick="|location.href='@{/disposal/disposalMain}'|">
                                새 배출
                            </button>
                        </div>
                        <div class="card-content">
                            <!-- 분리배출 통계 -->
                            <div class="waste-stats">
                                <div class="stat-item">
                                    <span class="stat-number">47</span>
                                    <span class="stat-label">이번 달</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number">12.3kg</span>
                                    <span class="stat-label">CO₂ 절약</span>
                                </div>
                            </div>

                            <!-- 최근 배출 내역 -->
                            <div class="waste-activities">
                                <h4>최근 활동</h4>
                                <div class="waste-list">
                                    <div class="waste-item">
                                        <div class="waste-icon plastic">♻️</div>
                                        <div class="item-info">
                                            <span class="item-name">플라스틱 병</span>
                                            <span class="item-date">3시간 전</span>
                                        </div>
                                        <span class="reward-points">+15P</span>
                                    </div>
                                    <div class="waste-item">
                                        <div class="waste-icon paper">📄</div>
                                        <div class="item-info">
                                            <span class="item-name">종이류</span>
                                            <span class="item-date">1일 전</span>
                                        </div>
                                        <span class="reward-points">+10P</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5. 포인트 내역 섹션 -->
                    <div class="dashboard-card points-history">
                        <div class="card-header">
                            <h3>💎 포인트 내역</h3>
                            <button class="btn-small" th:onclick="|location.href='@{/mypage/points}'|">
                                전체보기
                            </button>
                        </div>
                        <div class="card-content">
                            <!-- 포인트 요약 -->
                            <div class="points-summary">
                                <div class="current-points">
                                    <span class="points-amount">15,680P</span>
                                    <span class="points-label">보유 포인트</span>
                                </div>
                                <div class="points-change">
                                    <span class="points-earned">+2,340P</span>
                                    <span class="period-label">이번 달</span>
                                </div>
                            </div>

                            <!-- 최근 포인트 내역 -->
                            <div class="points-activities">
                                <h4>최근 적립/사용</h4>
                                <div class="points-list">
                                    <div class="points-item earn">
                                        <div class="item-info">
                                            <span class="item-desc">분리배출 완료</span>
                                            <span class="item-date">3시간 전</span>
                                        </div>
                                        <span class="points-value">+15P</span>
                                    </div>
                                    <div class="points-item use">
                                        <div class="item-info">
                                            <span class="item-desc">친환경 세제 구매</span>
                                            <span class="item-date">2일 전</span>
                                        </div>
                                        <span class="points-value">-500P</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- 회원정보 수정 모달 -->
        <div id="profileModal" class="modal-overlay" onclick="closeProfileModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <h3>회원정보 수정</h3>
                    <button class="modal-close" onclick="closeProfileModal()" aria-label="모달 닫기">×</button>
                </div>
                <div class="modal-body">
                    <form id="profileEditForm">
                        <!-- 닉네임 수정 -->
                        <div class="form-group">
                            <label for="editNickname">닉네임</label>
                            <div class="input-group">
                                <input type="text" id="editNickname" th:value="${member.nickname}" placeholder="닉네임을 입력하세요">
                                <button type="button" class="btn-validate" onclick="validateNickname()">중복확인</button>
                            </div>
                        </div>

                        <!-- 이메일 수정 -->
                        <div class="form-group">
                            <label for="editEmail">이메일</label>
                            <div class="input-group">
                                <input type="email" id="editEmail" th:value="${member.email}" placeholder="이메일을 입력하세요">
                                <button type="button" class="btn-validate" onclick="validateEmail()">중복확인</button>
                            </div>
                        </div>

                        <!-- 비밀번호 변경 -->
                        <div class="form-group">
                            <label for="currentPassword">현재 비밀번호</label>
                            <input type="password" id="currentPassword" placeholder="현재 비밀번호를 입력하세요">
                        </div>

                        <div class="form-group">
                            <label for="newPassword">새 비밀번호</label>
                            <input type="password" id="newPassword" placeholder="새 비밀번호를 입력하세요">
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">새 비밀번호 확인</label>
                            <input type="password" id="confirmPassword" placeholder="새 비밀번호를 다시 입력하세요">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeProfileModal()">취소</button>
                    <button type="button" class="btn-primary" onclick="saveProfileChanges()">저장</button>
                </div>
            </div>
        </div>

    </main>
</div>
<th:block layout:fragment="script">
    <script src="/js/mypage-script.js"></script>
</th:block>
<!-- 마이페이지 데이터를 JavaScript로 전달 -->
<script th:inline="javascript">
    // 서버에서 전달받은 데이터를 JavaScript 변수로 설정
    var userData = /*[[${user}]]*/ {};
    var userStatsData = /*[[${userStats}]]*/ {};
    var recentActivitiesData = /*[[${recentActivities}]]*/ [];

    // 전역 변수로 설정
    window.userData = userData;
    window.userStatsData = userStatsData;
    window.recentActivitiesData = recentActivitiesData;

    // 기간 변경 함수
    function changePeriod(period) {
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('period', period);
        window.location.href = currentUrl.toString();
    }

    // 프로필 편집 함수
    function editProfile() {
        // 프로필 편집 모달 또는 페이지로 이동
        location.href = '/mypage/profile/edit';
    }

    // 개인정보 다운로드 함수
    function downloadPersonalData() {
        if (confirm('개인정보를 다운로드하시겠습니까?')) {
            location.href = '/mypage/data/download';
        }
    }

    // 회원 탈퇴 확인 함수
    function confirmDeleteAccount() {
        if (confirm('정말로 회원 탈퇴하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
            location.href = '/mypage/account/delete';
        }
    }
</script>
</html>