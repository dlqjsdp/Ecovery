<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<th:block layout:fragment="css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/free-sharing-register.css">
</th:block>

<!-- Main Content -->
<div layout:fragment="content">


    <!-- í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ (ë¹µë¶€ìŠ¤ëŸ¬ê¸°) -->
    <section class="breadcrumb">
        <div class="container">
            <nav class="breadcrumb-nav">
                <a th:href="@{/}">ğŸ </a>
                <span>></span>
                <a th:href="@{/free/list}">ë¬´ë£Œë‚˜ëˆ”</a>
                <span>></span>
                <span class="current">ë‚˜ëˆ” ë“±ë¡</span>
            </nav>
        </div>
    </section>


    <!-- ë“±ë¡ í¼ -->
    <section class="registration-section">
        <div class="container">
            <!-- í¼ ì»¨í…Œì´ë„ˆ -->
            <div class="form-container">
                <!-- í¼ í—¤ë” -->
                <div class="form-header">
                    <h2>ë‚˜ëˆ” ë¬¼í’ˆ ë“±ë¡í•˜ê¸°</h2>
                    <p>ì •í™•í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì‹œë©´ ë” ë§ì€ ì´ì›ƒë“¤ì´ ê´€ì‹¬ì„ ê°€ì§ˆ ìˆ˜ ìˆì–´ìš”</p>
                </div>

                <!-- ì‹¤ì œ í¼ - Thymeleaf í¼ ê°ì²´ ë°”ì¸ë”© -->
                <form class="form-body" id="registrationForm"
                      th:action="@{/free/register}"
                      th:object="${sharingForm}"
                      method="post"
                      enctype="multipart/form-data">

                    <!-- ì œëª© ì…ë ¥ -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì œëª© <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <input type="text"
                                   class="form-input"
                                   th:field="*{title}"
                                   id="title"
                                   placeholder="ë‚˜ëˆ”í•  ë¬¼í’ˆì˜ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                   required>
                            <!-- Thymeleaf ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ ë©”ì‹œì§€ -->
                            <div class="error-message" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
                            <div class="help-text">ë¬¼í’ˆëª…ê³¼ ìƒíƒœë¥¼ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš” (ì˜ˆ: ì•„ì´ ì „ì§‘ (ìƒíƒœ ì¢‹ìŒ))</div>
                        </div>
                    </div>

                    <!-- ì‘ì„±ì (ìë™ ì…ë ¥) -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì‘ì„±ì <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <input type="text"
                                   class="form-input"s
                                   id="author"
                                   th:value="${session.memberNickname}"
                                   readonly>
                            <!-- ìˆ¨ê²¨ì§„ í•„ë“œë¡œ ì‘ì„±ì ID ì „ì†¡ -->
                            <input type="hidden" th:field="*{memberId}" th:value="${session.memberId}" id="memberId">
                            <div class="help-text">ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ê°€ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤</div>
                        </div>
                    </div>

                    <!-- ë“±ë¡ì¼ (ìë™ ì…ë ¥) -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ë“±ë¡ì¼</label>
                        </div>
                        <div class="form-input-section">
                            <input type="text"
                                   class="form-input"
                                   id="regDate"
                                   th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd HH:mm')}"
                                   readonly>
                        </div>
                    </div>

                    <!-- ìƒí’ˆ ìƒíƒœ ì„ íƒ -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ìƒí’ˆìƒíƒœ <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <select class="form-select" th:field="*{itemCondition}" id="condition" required>
                                <option value="">ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                <option value="HIGH">ìƒ (ë§¤ìš° ì¢‹ìŒ)</option>
                                <option value="MEDIUM">ì¤‘ (ë³´í†µ)</option>
                                <option value="LOW">í•˜ (ì‚¬ìš©ê° ìˆìŒ)</option>
                            </select>
                            <div class="error-message" th:if="${#fields.hasErrors('itemCondition')}" th:errors="*{itemCondition}"></div>
                            <div class="help-text">ë¬¼í’ˆì˜ ì „ë°˜ì ì¸ ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                            <!-- ìƒí’ˆ ìƒíƒœ ë¯¸ë¦¬ë³´ê¸° (JavaScriptë¡œ ì œì–´) -->
                            <div class="condition-preview" id="conditionPreview"></div>
                        </div>
                    </div>

                    <!-- ì§€ì—­ ì„ íƒ -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì§€ì—­ <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <div class="form-group">
                                <!-- êµ¬ ì„ íƒ -->
                                <select class="form-select" th:field="*{regionGu}" id="region1" required>
                                    <option value="">êµ¬</option>
                                    <option value="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬</option>
                                    <option value="ê°•ë™êµ¬">ê°•ë™êµ¬</option>
                                    <option value="ê°•ë¶êµ¬">ê°•ë¶êµ¬</option>
                                    <option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬</option>
                                    <option value="ê´€ì•…êµ¬">ê´€ì•…êµ¬</option>
                                    <option value="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬</option>
                                    <option value="êµ¬ë¡œêµ¬">êµ¬ë¡œêµ¬</option>
                                    <option value="ê¸ˆì²œêµ¬">ê¸ˆì²œêµ¬</option>
                                    <option value="ë…¸ì›êµ¬">ë…¸ì›êµ¬</option>
                                    <option value="ë„ë´‰êµ¬">ë„ë´‰êµ¬</option>
                                    <option value="ë™ëŒ€ë¬¸êµ¬">ë™ëŒ€ë¬¸êµ¬</option>
                                    <option value="ë™ì‘êµ¬">ë™ì‘êµ¬</option>
                                    <option value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬</option>
                                    <option value="ì„œëŒ€ë¬¸êµ¬">ì„œëŒ€ë¬¸êµ¬</option>
                                    <option value="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬</option>
                                    <option value="ì„±ë™êµ¬">ì„±ë™êµ¬</option>
                                    <option value="ì„±ë¶êµ¬">ì„±ë¶êµ¬</option>
                                    <option value="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬</option>
                                    <option value="ì–‘ì²œêµ¬">ì–‘ì²œêµ¬</option>
                                    <option value="ì˜ë“±í¬êµ¬">ì˜ë“±í¬êµ¬</option>
                                    <option value="ìš©ì‚°êµ¬">ìš©ì‚°êµ¬</option>
                                    <option value="ì€í‰êµ¬">ì€í‰êµ¬</option>
                                    <option value="ì¢…ë¡œêµ¬">ì¢…ë¡œêµ¬</option>
                                    <option value="ì¤‘êµ¬">ì¤‘êµ¬</option>
                                    <option value="ì¤‘ë‘êµ¬">ì¤‘ë‘êµ¬</option>
                                </select>
                                <!-- ë™ ì„ íƒ (JavaScriptë¡œ ë™ì  ë¡œë“œ) -->
                                <select class="form-select" th:field="*{regionDong}" id="region2" required>
                                    <option value="">ë™</option>
                                </select>
                            </div>
                            <div class="error-message" th:if="${#fields.hasErrors('regionGu')}" th:errors="*{regionGu}"></div>
                            <div class="error-message" th:if="${#fields.hasErrors('regionDong')}" th:errors="*{regionDong}"></div>
                            <div class="help-text">ë‚˜ëˆ”ì„ ì§„í–‰í•  ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                        </div>
                    </div>

                    <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì¹´í…Œê³ ë¦¬ <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <select class="form-select" th:field="*{category}" id="category" required>
                                <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                <!-- ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¶œë ¥ -->
                                <option value="ê°€êµ¬" th:selected="${sharingForm.category == 'ê°€êµ¬'}">ê°€êµ¬</option>
                                <option value="ê°€ì „" th:selected="${sharingForm.category == 'ê°€ì „'}">ê°€ì „</option>
                                <option value="ì¡í™”" th:selected="${sharingForm.category == 'ì¡í™”'}">ì¡í™”</option>
                                <option value="ê¸°íƒ€" th:selected="${sharingForm.category == 'ê¸°íƒ€'}">ê¸°íƒ€</option>
                            </select>
                            <div class="error-message" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
                        </div>
                    </div>

                    <!-- ìƒí’ˆ ì„¤ëª… -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ìƒí’ˆì„¤ëª… <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                                <textarea class="form-input form-textarea"
                                          th:field="*{content}"
                                          id="description"
                                          placeholder="ë¬¼í’ˆì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì ì–´ì£¼ì„¸ìš”"
                                          required></textarea>
                            <div class="error-message" th:if="${#fields.hasErrors('content')}" th:errors="*{content}"></div>
                            <div class="help-text">ë¬¼í’ˆì˜ ìƒíƒœ, ì‚¬ìš© ê¸°ê°„, íŠ¹ì´ì‚¬í•­ ë“±ì„ ìì„¸íˆ ì ì–´ì£¼ì‹œë©´ ì¢‹ì•„ìš”</div>
                        </div>
                    </div>

                    <!-- ê±°ë˜ ë°©ë²• ì„ íƒ -->
                    <!--<div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ê±°ë˜ ë°©ë²• <span class="required">*</span></label>
                        </div>
                        <div class="form-input-section">
                            <div class="trade-methods">
                                <label class="checkbox-label">
                                    <input type="checkbox" th:field="*{tradeMethods}" value="DIRECT" id="directTrade">
                                    <span class="checkmark"></span>
                                    ì§ê±°ë˜
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" th:field="*{tradeMethods}" value="DELIVERY" id="deliveryTrade">
                                    <span class="checkmark"></span>
                                    íƒë°°ê±°ë˜
                                </label>
                            </div>
                            <div class="error-message" th:if="${#fields.hasErrors('tradeMethods')}" th:errors="*{tradeMethods}"></div>
                            <div class="help-text">ê°€ëŠ¥í•œ ê±°ë˜ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                        </div>
                    </div>-->

                    <!-- ì—°ë½ì²˜ ì •ë³´ -->
                    <!--<div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì—°ë½ì²˜</label>
                        </div>
                        <div class="form-input-section">
                            <div class="contact-group">
                                <div class="contact-item">
                                    <label>ì „í™”ë²ˆí˜¸</label>
                                    <input type="tel" th:field="*{phoneNumber}" placeholder="010-0000-0000">
                                </div>
                                <div class="contact-item">
                                    <label>ì¹´ì¹´ì˜¤í†¡ ID</label>
                                    <input type="text" th:field="*{kakaoId}" placeholder="ì¹´ì¹´ì˜¤í†¡ ID">
                                </div>
                            </div>
                            <div class="help-text">ì—°ë½ ë°›ì„ ìˆ˜ ìˆëŠ” ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
                        </div>
                    </div>-->

                    <!-- ì‚¬ì§„ ì—…ë¡œë“œ -->
                    <div class="form-row">
                        <div class="form-label-section">
                            <label class="form-label">ì‚¬ì§„ ì²¨ë¶€</label>
                        </div>
                        <div class="form-input-section">
                            <!-- ì‚¬ì§„ ì—…ë¡œë“œ ì˜ì—­ -->
                            <div class="image-upload-area" id="imageUploadArea">
                                <div class="upload-icon">ğŸ“·</div>
                                <div class="upload-text">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</div>
                                <div class="upload-hint">ìµœëŒ€ 5ê°œê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥ (JPG, PNG)</div>
                            </div>
                            <!-- ì‹¤ì œ íŒŒì¼ ì…ë ¥ -->
                            <input type="file" th:field="*{imgList}" id="imageInput" multiple accept="image/*" name="imgFile" style="display: none;">
                            <div class="error-message" th:if="${#fields.hasErrors('imgList')}" th:errors="*{imgList}"></div>
                            <!-- ì—…ë¡œë“œëœ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° (JavaScriptë¡œ ì œì–´) -->
                            <div class="image-preview" id="imagePreview"></div>
                            <div class="help-text">ë¬¼í’ˆ ì‚¬ì§„ì„ ì˜¬ë ¤ì£¼ì‹œë©´ ë‚˜ëˆ” ì„±ê³µë¥ ì´ ë†’ì•„ì ¸ìš”</div>
                        </div>
                    </div>
                </form>

                <!-- í¼ ë²„íŠ¼ë“¤ -->
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" th:onclick="|location.href='@{/free/list}'|">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-submit" form="registrationForm">ë“±ë¡í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </section>
</div>


<!-- JavaScript íŒŒì¼ ì—°ê²° - Thymeleaf ì •ì  ë¦¬ì†ŒìŠ¤ ê²½ë¡œ -->
<th:block layout:fragment="script">
    <script src="/js/free-sharing-register.js"></script>



    <!-- í¼ ë°ì´í„°ë¥¼ JavaScriptë¡œ ì „ë‹¬ -->
    <script th:inline="javascript">
        // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ JavaScript ë³€ìˆ˜ë¡œ ì„¤ì •
        var categoriesData = /*[[${sharingForm.category}]]*/ [];
        var regionsData = /*[[${sharingForm.regionGu}]]*/ [];
        var currentUser = /*[[${session.memberNickname}]]*/ {};

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.categoriesData = categoriesData;
        window.regionsData = regionsData;
        window.currentUser = currentUser;

        // ìƒí’ˆ ìƒíƒœ ì„ íƒì‹œ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        document.getElementById('condition').addEventListener('change', function() {
            const conditionPreview = document.getElementById('conditionPreview');
            const selectedValue = this.value;

            if (selectedValue) {
                let conditionText = '';
                let stars = '';

                switch(selectedValue) {
                    case 'HIGH':
                        conditionText = 'ë§¤ìš° ì¢‹ìŒ - ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ìƒˆ ì œí’ˆê³¼ ê°™ì€ ìƒíƒœ';
                        stars = 'â­â­â­â­â­';
                        break;
                    case 'MEDIUM':
                        conditionText = 'ë³´í†µ - ì¼ë°˜ì ì¸ ì‚¬ìš©ê°ì´ ìˆì§€ë§Œ ê¸°ëŠ¥ìƒ ë¬¸ì œì—†ìŒ';
                        stars = 'â­â­â­';
                        break;
                    case 'LOW':
                        conditionText = 'ì‚¬ìš©ê° ìˆìŒ - ì˜¤ë˜ ì‚¬ìš©í•˜ì—¬ í”ì ì´ ìˆì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥';
                        stars = 'â­â­';
                        break;
                }

                conditionPreview.innerHTML = `

                    <div style="padding: 10px; background: #f5f5f5; border-radius: 5px; margin-top: 10px;">
                        <span style="font-size: 16px;">${stars}</span>
                        <span style="margin-left: 10px; color: #666;">${conditionText}</span>
                    </div>
                `;

            } else {
                conditionPreview.innerHTML = '';
            }
        });

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        /*document.getElementById('imageInput').addEventListener('change', function(event) {
            const files = event.target.files;
            const imagePreview = document.getElementById('imagePreview');

            // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            imagePreview.innerHTML = '';

            if (files.length > 5) {
                alert('ìµœëŒ€ 5ê°œì˜ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                this.value = '';
                return;
            }


            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'preview-image';
                        imageDiv.innerHTML = `
                                <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸° ${index + 1}">
                                <button type="button" class="remove-image" onclick="removeImage(${index})">Ã—</button>
                            `;
                        imagePreview.appendChild(imageDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
        });*/

        // ì´ë¯¸ì§€ ì œê±° í•¨ìˆ˜
        /*function removeImage(index) {
            const imageInput = document.getElementById('imageInput');
            const dt = new DataTransfer();
            const files = Array.from(imageInput.files);

            files.splice(index, 1);
            files.forEach(file => dt.items.add(file));

            imageInput.files = dt.files;

            // ë¯¸ë¦¬ë³´ê¸° ë‹¤ì‹œ ìƒì„±
            const changeEvent = new Event('change', { bubbles: true });
            imageInput.dispatchEvent(changeEvent);
        }*/
    </script>

</th:block>

</html>